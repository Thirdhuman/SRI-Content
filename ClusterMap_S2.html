<html>

<head>
    <meta charset='utf-8' />
    <title>Opportunity Zones</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.3.1/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.3.1/mapbox-gl.css' rel='stylesheet' />

    <style>
        body {
            color: #404040;
            font: 400 15px/22px 'Source Sans Pro', 'Helvetica Neue', Sans-serif;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            margin: 0;
            padding: 0;
        }

        #map {
            /* border-left: 1px solid #fff; */
            position: relative;
            /* left: 33.3333%;
            width: 66.6666%; */
            top: 0;
            bottom: 0;
        }

        .mapboxgl-popup {
            max-width: 1200px;
            font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
        }

        .pad2 {
            padding: 20px;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }

        .mapboxgl-ctrl-logo {
            display: none !important;
        }


        .listings {
            height: 100%;
            overflow: auto;
            padding-bottom: 60px;
        }

        .sidebar {
            position: relative;
            width: 33.3333%;
            height: 100%;
            top: 0;
            background: rgba(0, 0, 0, 0.3);
            left: 0;
            overflow: hidden;

        }
    </style>
</head>

<body>
    <style>
        #Reset {
            display: block;
            position: relative;
            margin: 0px auto;
            width: 50%;
            height: 40px;
            padding: 10px;
            border: none;
            border-radius: 3px;
            font-size: 18px;
            text-align: center;
            color: rgb(12, 12, 12);
            background: #fffefe;
        }
    </style>
    <style type='text/css'>
        #info {
            display: block;
            position: relative;
            margin: 0px auto;
            width: 50%;
            padding: 10px;
            border: none;
            border-radius: 3px;
            font-size: 12px;
            text-align: center;
            color: #222;
            background: #fff;
        }
    </style>


    <div id='map' class='map' style='width: 100%; height: 850px;'></div>
    <button id='Reset'> <strong>Reset Map<strong></button>
    <pre id='info'></pre>


    <script>
        // var bounds = [
        // [-120, -20], // Southwest coordinates
        // [45, -80] // Northeast coordinates
        // ];

        // var filterGroup = document.getElementById('filter-group');
        mapboxgl.accessToken =
            'pk.eyJ1IjoidGhpcmRodW1hbiIsImEiOiJjamljYXUyeTcwNHBlM3hxb3dtZWtiMmFpIn0.5BIldxj0ATxmuJBaknExeQ';
        var map = new mapboxgl.Map({
            container: 'map',
            zoomControl: false,
            style: 'mapbox://styles/thirdhuman/ck04kj0h30l2o1crz23guljy8',
            // center: [-93.85, 37.45],
            // zoom: 4.31
            // maxBounds: bounds // Sets bounds as max
        });

        var hoveredTractId = null;
        var hoveredStateId = null;
        var clickStateId = null;
        var toggleableLayerIds = ['tract-shapes', 'tract-colors'];

        map.on('load', function () {
            map.addControl(new mapboxgl.NavigationControl({
                showCompass: false
            }), 'bottom-right');


            // map.on('click', 'state-shapes', function (e) {
            //     console.log(e.features[0].geometry.coordinates);
            //     var polys = e.features[0].geometry.coordinates;
            //     // console.log(r);
            //     console.log(polys);
            //     // console.log(p);
            //     // map.flyTo({ center: p });
            // });

            // Change the cursor to a pointer when the it enters a feature in the 'symbols' layer.
            map.on('mouseenter', 'state-shapes', function () {
                map.getCanvas().style.cursor = 'pointer';
            });

            // Change it back to a pointer when it leaves.
            map.on('mouseleave', 'state-shapes', function () {
                map.getCanvas().style.cursor = '';
            });

            // console.log(test1)
            // var test2 = map.queryRenderedFeatures({ layers: ['state-shapes'] });
            // console.log(test2[0])
            // var test3 = map.queryRenderedFeatures({ layers: ['state-fills'] });
            // console.log(test3)

            // console.log(test3.id)

            map.on("mousemove", "state-shapes", function (e) {
                console.log(e.features[0].id)
                // console.log(e.features.length)
                console.log(hoveredStateId)
                if (e.features.length > 0) {
                    if (hoveredStateId) {
                        map.setFeatureState({
                            source: 'composite',
                            sourceLayer: "state_shapes_ab",
                            id: hoveredStateId
                        }, { hover: false });
                    }
                    hoveredStateId = e.features[0].id;
                    console.log(hoveredStateId)
                    map.setFeatureState({
                        source: 'composite',
                        sourceLayer: "state_shapes_ab",
                        id: hoveredStateId
                    }, { hover: true });
                    console.log(hoveredStateId)
                }
            });


            map.on("mousemove", "tract-shapes", function (e) {
                console.log(e.features[0].id)
                // console.log(e.features.length)
                console.log(hoveredTractId)
                if (e.features.length > 0) {
                    if (hoveredStateId) {
                        map.setFeatureState({
                            source: 'composite',
                            sourceLayer: "Cluster_final_ab",
                            id: hoveredStateId
                        }, { hover: false });
                    }
                    hoveredTractId = e.features[0].id;
                    console.log(hoveredTractId)
                    map.setFeatureState({
                        source: 'composite',
                        sourceLayer: "Cluster_final_ab",
                        id: hoveredTractId
                    }, { hover: true });
                    console.log(hoveredTractId)
                }
            });


            map.on("click", "state-lines", function (e) {
                console.log(e.features[0].id)
                // console.log(e.features.length)
                console.log(clickStateId)
                if (e.features.length > 0) {
                    if (clickStateId) {
                        map.setFeatureState({
                            source: 'composite',
                            sourceLayer: "state_shapes_ab",
                            id: clickStateId
                        }, { hover: false });
                    }
                    clickStateId = e.features[0].id;
                    console.log(clickStateId)
                    map.setFeatureState({
                        source: 'composite',
                        sourceLayer: "state_shapes_ab",
                        id: clickStateId
                    }, { hover: true });
                    console.log(clickStateId)
                }
            });



            // When the mouse leaves the state-fill layer, update the feature state of the
            // previously hovered feature.
            map.on("mouseleave", "state-shapes", function () {
                if (hoveredStateId) {
                    map.setFeatureState({
                        source: 'composite',
                        sourceLayer: "state_shapes_ab",
                        id: hoveredStateId
                    }, { hover: false });
                }
                hoveredStateId = null;
            });

            map.scrollZoom.disable();

            document.getElementById('Reset').addEventListener('click', function () {
                map.flyTo({
                    center: [0.7342787982274785, 0.6163695229006692]
                    , zoom: 3.8
                    , speed: 1
                });
                popup.remove();

            });


            map.on('click', 'state-shapes', function (e) {
                coords = [e.features[0].properties.lng, e.features[0].properties.lat]
                map.flyTo({
                    center: coords
                    , zoom: 6.75
                    , speed: 0.45
                });
                popup.remove();
            });


                
            for (var i = 0; i < toggleableLayerIds.length; i++) {
                    var id = toggleableLayerIds[i];

                    var link = document.createElement('a');
                    link.href = '#';
                    link.className = 'active';
                    link.textContent = id;

                    link.onclick = function (e) {
                        var clickedLayer = this.textContent;
                        e.preventDefault();
                        e.stopPropagation();

                        var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

                        if (visibility === 'visible') {
                            map.setLayoutProperty(clickedLayer, 'visibility', 'none');
                            this.className = '';
                        } else {
                            this.className = 'active';
                            map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
                        }
                    };
                    var layers = document.getElementById('info');
                    layers.appendChild(link);
                }

            map.on('click', 'tract-shapes', function (e) {
                new mapboxgl.Popup()
                    .setLngLat(e.lngLat)
                    .setHTML(
                        "<strong>Tract Number: </strong>" + e.features[0].properties.GEOID
                        + "<br />" + "<strong>Tract Type: </strong>" + e.features[0].properties.Final_Cluster
                        + "<br />" + "<strong>Opportunity Zone Status: </strong>" + e.features[0].properties.OZ
                        + "<br />" + "<strong>Index_Placeholder: </strong>" + e.features[0].properties.ind1
                    )
                    .addTo(map);
            });

            map.on('mousemove', function (e) {
                document.getElementById('info').innerHTML =
                    // e.point is the x, y coordinates of the mousemove event relative
                    // to the top-left corner of the map
                    JSON.stringify(e.point) + '<br />' +
                    layers.appendChild(link) + '<br />' +

                    // e.lngLat is the longitude, latitude geographical position of the event
                    JSON.stringify(e.lngLat.wrap());
            });


            map.on('click', function (e) {
                console.log(document.getElementById('info').innerHTML)
            });
        });


    </script>


</body>

</html>